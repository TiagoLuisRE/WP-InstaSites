;
/*! Improved jQuery.cookie plugin by @mathias: http://mths.be/cookie */
;(function(a,b){b.cookie=function(g,h,f){var c="",e,d;if(typeof h!="undefined"){f||(f={});if(!h){h="";f.expires=-1}if(f.expires&&(typeof f.expires=="number"||f.expires.toUTCString)){e=new Date;if(typeof f.expires=="number"){e.setTime(+new Date()+(f.expires*86400000))}else{e=f.expires}c="; expires="+e.toUTCString()}a.cookie=[g,"=",encodeURIComponent(h),c,f.path?"; path="+f.path:"",f.domain?"; domain="+f.domain:"",f.secure?"; secure":""].join("")}else{d=a.cookie.match(new RegExp("(?:^|;)\\s?"+g.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"=(.*?)(?:;|$)","i"));return d&&unescape(d[1])}}}(document,jQuery));

/* moment.js */
;(function(e){function O(e,t){return function(n){return j(e.call(this,n),t)}}function M(e){return function(t){return this.lang().ordinal(e.call(this,t))}}function _(){}function D(e){H(this,e)}function P(e){var t=this._data={},n=e.years||e.year||e.y||0,r=e.months||e.month||e.M||0,i=e.weeks||e.week||e.w||0,s=e.days||e.day||e.d||0,o=e.hours||e.hour||e.h||0,u=e.minutes||e.minute||e.m||0,a=e.seconds||e.second||e.s||0,f=e.milliseconds||e.millisecond||e.ms||0;this._milliseconds=f+a*1e3+u*6e4+o*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=f%1e3,a+=B(f/1e3),t.seconds=a%60,u+=B(a/60),t.minutes=u%60,o+=B(u/60),t.hours=o%24,s+=B(o/24),s+=i*7,t.days=s%30,r+=B(s/30),t.months=r%12,n+=B(r/12),t.years=n}function H(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function B(e){return e<0?Math.ceil(e):Math.floor(e)}function j(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function F(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function I(e){return Object.prototype.toString.call(e)==="[object Array]"}function q(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function R(e,t){return t.abbr=e,s[e]||(s[e]=new _),s[e].set(t),s[e]}function U(e){return e?(!s[e]&&o&&require("./lang/"+e),s[e]):t.fn._lang}function z(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function W(e){var t=e.match(a),n,r;for(n=0,r=t.length;n<r;n++)A[t[n]]?t[n]=A[t[n]]:t[n]=z(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function X(e,t){function r(t){return e.lang().longDateFormat(t)||t}var n=5;while(n--&&f.test(t))t=t.replace(f,r);return C[t]||(C[t]=W(t)),C[t](e)}function V(e){switch(e){case"DDDD":return p;case"YYYY":return d;case"YYYYY":return v;case"S":case"SS":case"SSS":case"DDD":return h;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return m;case"X":return b;case"Z":case"ZZ":return g;case"T":return y;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return c;default:return new RegExp(e.replace("\\",""))}}function $(e,t,n){var r,i,s=n._a;switch(e){case"M":case"MM":s[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":r=U(n._l).monthsParse(t),r!=null?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(s[2]=~~t);break;case"YY":s[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~t;break;case"a":case"A":n._isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":s[3]=~~t;break;case"m":case"mm":s[4]=~~t;break;case"s":case"ss":s[5]=~~t;break;case"S":case"SS":case"SSS":s[6]=~~(("0."+t)*1e3);break;case"X":n._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":n._useUTC=!0,r=(t+"").match(x),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&r[0]==="+"&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}t==null&&(n._isValid=!1)}function J(e){var t,n,r=[];if(e._d)return;for(t=0;t<7;t++)e._a[t]=r[t]=e._a[t]==null?t===2?1:0:e._a[t];r[3]+=e._tzh||0,r[4]+=e._tzm||0,n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}function K(e){var t=e._f.match(a),n=e._i,r,i;e._a=[];for(r=0;r<t.length;r++)i=(V(t[r]).exec(n)||[])[0],i&&(n=n.slice(n.indexOf(i)+i.length)),A[t[r]]&&$(t[r],i,e);e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&e._a[3]===12&&(e._a[3]=0),J(e)}function Q(e){var t,n,r,i=99,s,o,u;while(e._f.length){t=H({},e),t._f=e._f.pop(),K(t),n=new D(t);if(n.isValid()){r=n;break}u=q(t._a,n.toArray()),u<i&&(i=u,r=n)}H(e,r)}function G(e){var t,n=e._i;if(w.exec(n)){e._f="YYYY-MM-DDT";for(t=0;t<4;t++)if(S[t][1].exec(n)){e._f+=S[t][0];break}g.exec(n)&&(e._f+=" Z"),K(e)}else e._d=new Date(n)}function Y(t){var n=t._i,r=u.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):typeof n=="string"?G(t):I(n)?(t._a=n.slice(0),J(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function Z(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function et(e,t,n){var i=r(Math.abs(e)/1e3),s=r(i/60),o=r(s/60),u=r(o/24),a=r(u/365),f=i<45&&["s",i]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",r(u/30)]||a===1&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,Z.apply({},f)}function tt(e,n,r){var i=r-n,s=r-e.day();return s>i&&(s-=7),s<i-7&&(s+=7),Math.ceil(t(e).add("d",s).dayOfYear()/7)}function nt(e){var n=e._i,r=e._f;return n===null||n===""?null:(typeof n=="string"&&(e._i=n=U().preparse(n)),t.isMoment(n)?(e=H({},n),e._d=new Date(+n._d)):r?I(r)?Q(e):K(e):Y(e),new D(e))}function rt(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var t=this._isUTC?"UTC":"";return e!=null?(this._d["set"+t+n](e),this):this._d["get"+t+n]()}}function it(e){t.duration.fn[e]=function(){return this._data[e]}}function st(e,n){t.duration.fn["as"+e]=function(){return+this/n}}var t,n="2.0.0",r=Math.round,i,s={},o=typeof module!="undefined"&&module.exports,u=/^\/?Date\((\-?\d+)/i,a=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,f=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,l=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,c=/\d\d?/,h=/\d{1,3}/,p=/\d{3}/,d=/\d{1,4}/,v=/[+\-]?\d{1,6}/,m=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,g=/Z|[\+\-]\d\d:?\d\d/i,y=/T/i,b=/[\+\-]?\d+(\.\d{1,3})?/,w=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,E="YYYY-MM-DDTHH:mm:ssZ",S=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],x=/([\+\-]|\d\d)/gi,T="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),N={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},C={},k="DDD w W M D d".split(" "),L="M D H h m s w W".split(" "),A={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return j(this.year()%100,2)},YYYY:function(){return j(this.year(),4)},YYYYY:function(){return j(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return j(~~(this.milliseconds()/10),2)},SSS:function(){return j(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(e/60),2)+":"+j(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(10*e/6),4)},X:function(){return this.unix()}};while(k.length)i=k.pop(),A[i+"o"]=M(A[i]);while(L.length)i=L.pop(),A[i+i]=O(A[i],2);A.DDDD=O(A.DDD,3),_.prototype={set:function(e){var t,n;for(n in e)t=e[n],typeof t=="function"?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,r,i,s;this._monthsParse||(this._monthsParse=[]);for(n=0;n<12;n++){this._monthsParse[n]||(r=t([2e3,n]),i="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[n]=new RegExp(i.replace(".",""),"i"));if(this._monthsParse[n].test(e))return n}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return typeof n=="function"?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return typeof i=="function"?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n=="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return tt(e,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},t=function(e,t,n){return nt({_i:e,_f:t,_l:n,_isUTC:!1})},t.utc=function(e,t,n){return nt({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},t.unix=function(e){return t(e*1e3)},t.duration=function(e,n){var r=t.isDuration(e),i=typeof e=="number",s=r?e._data:i?{}:e,o;return i&&(n?s[n]=e:s.milliseconds=e),o=new P(s),r&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},t.version=n,t.defaultFormat=E,t.lang=function(e,n){var r;if(!e)return t.fn._lang._abbr;n?R(e,n):s[e]||U(e),t.duration.fn._lang=t.fn._lang=U(e)},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),U(e)},t.isMoment=function(e){return e instanceof D},t.isDuration=function(e){return e instanceof P},t.fn=D.prototype={clone:function(){return t(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return t.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return this._isValid==null&&(this._a?this._isValid=!q(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){var n=X(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),F(this,r,1),this},subtract:function(e,n){var r;return typeof e=="string"?r=t.duration(+n,e):r=t.duration(e,n),F(this,r,-1),this},diff:function(e,n,r){var i=this._isUTC?t(e).utc():t(e).local(),s=(this.zone()-i.zone())*6e4,o,u;return n&&(n=n.replace(/s$/,"")),n==="year"||n==="month"?(o=(this.daysInMonth()+i.daysInMonth())*432e5,u=(this.year()-i.year())*12+(this.month()-i.month()),u+=(this-t(this).startOf("month")-(i-t(i).startOf("month")))/o,n==="year"&&(u/=12)):(o=this-i-s,u=n==="second"?o/1e3:n==="minute"?o/6e4:n==="hour"?o/36e5:n==="day"?o/864e5:n==="week"?o/6048e5:o),r?u:B(u)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().startOf("day"),"days",!0),n=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<t([this.year()]).zone()||this.zone()<t([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){e=e.replace(/s$/,"");switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return e==="week"&&this.day(0),this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,n){return n=typeof n!="undefined"?n:"millisecond",+this.clone().startOf(n)===+t(e).startOf(n)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return t.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var n=r((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?n:this.add("d",e-n)},isoWeek:function(e){var t=tt(this,1,4);return e==null?t:this.add("d",(e-t)*7)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},lang:function(t){return t===e?this._lang:(this._lang=U(t),this)}};for(i=0;i<T.length;i++)rt(T[i].toLowerCase().replace(/s$/,""),T[i]);rt("year","FullYear"),t.fn.days=t.fn.day,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.duration.fn=P.prototype={weeks:function(){return B(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=et(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},lang:t.fn.lang};for(i in N)N.hasOwnProperty(i)&&(st(i,N[i]),it(i.toLowerCase()));st("Weeks",6048e5),t.lang("en",{ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),o&&(module.exports=t),typeof ender=="undefined"&&(this.moment=t),typeof define=="function"&&define.amd&&define("moment",[],function(){return t})}).call(this);

/* piwik */
;if(!this.JSON2){this.JSON2={}}(function(){function f(n){return n<10?"0"+n:n}function objectToJSON(value,key){var objectType=Object.prototype.toString.apply(value);if(objectType==="[object Date]"){return isFinite(value.valueOf())?value.getUTCFullYear()+"-"+f(value.getUTCMonth()+1)+"-"+f(value.getUTCDate())+"T"+f(value.getUTCHours())+":"+f(value.getUTCMinutes())+":"+f(value.getUTCSeconds())+"Z":null}if(objectType==="[object String]"||objectType==="[object Number]"||objectType==="[object Boolean]"){return value.valueOf()}if(objectType!=="[object Array]"&&typeof value.toJSON==="function"){return value.toJSON(key)}return value}var cx=new RegExp("[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]","g"),pattern='\\\\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]',escapable=new RegExp("["+pattern,"g"),gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"){value=objectToJSON(value,key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON2.stringify!=="function"){JSON2.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON2.parse!=="function"){JSON2.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if((new RegExp("^[\\],:{}\\s]*$")).test(text.replace(new RegExp('\\\\(?:["\\\\/bfnrt]|u[0-9a-fA-F]{4})',"g"),"@").replace(new RegExp('"[^"\\\\\n\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?',"g"),"]").replace(new RegExp("(?:^|:|,)(?:\\s*\\[)+","g"),""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var _paq=_paq||[],Piwik=Piwik||(function(){var expireDateTime,plugins={},documentAlias=document,navigatorAlias=navigator,screenAlias=screen,windowAlias=window,hasLoaded=false,registeredOnLoadHandlers=[],encodeWrapper=windowAlias.encodeURIComponent,decodeWrapper=windowAlias.decodeURIComponent,urldecode=unescape,asyncTracker,i;function isDefined(property){return"undefined"!==typeof property}function isFunction(property){return typeof property==="function"}function isObject(property){return typeof property==="object"}function isString(property){return typeof property==="string"||property instanceof String}function apply(){var i,f,parameterArray;for(i=0;i<arguments.length;i+=1){parameterArray=arguments[i];f=parameterArray.shift();if(isString(f)){asyncTracker[f].apply(asyncTracker,parameterArray)}else{f.apply(asyncTracker,parameterArray)}}}function addEventListener(element,eventType,eventHandler,useCapture){if(element.addEventListener){element.addEventListener(eventType,eventHandler,useCapture);return true}if(element.attachEvent){return element.attachEvent("on"+eventType,eventHandler)}element["on"+eventType]=eventHandler}function executePluginMethod(methodName,callback){var result="",i,pluginMethod;for(i in plugins){if(Object.prototype.hasOwnProperty.call(plugins,i)){pluginMethod=plugins[i][methodName];if(isFunction(pluginMethod)){result+=pluginMethod(callback)}}}return result}function beforeUnloadHandler(){var now;executePluginMethod("unload");if(expireDateTime){do{now=new Date()}while(now.getTimeAlias()<expireDateTime)}}function loadHandler(){var i;if(!hasLoaded){hasLoaded=true;executePluginMethod("load");for(i=0;i<registeredOnLoadHandlers.length;i++){registeredOnLoadHandlers[i]()}}return true}function addReadyListener(){var _timer;if(documentAlias.addEventListener){addEventListener(documentAlias,"DOMContentLoaded",function ready(){documentAlias.removeEventListener("DOMContentLoaded",ready,false);loadHandler()})}else{if(documentAlias.attachEvent){documentAlias.attachEvent("onreadystatechange",function ready(){if(documentAlias.readyState==="complete"){documentAlias.detachEvent("onreadystatechange",ready);loadHandler()}});if(documentAlias.documentElement.doScroll&&windowAlias===windowAlias.top){(function ready(){if(!hasLoaded){try{documentAlias.documentElement.doScroll("left")}catch(error){setTimeout(ready,0);return}loadHandler()}}())}}}if((new RegExp("WebKit")).test(navigatorAlias.userAgent)){_timer=setInterval(function(){if(hasLoaded||/loaded|complete/.test(documentAlias.readyState)){clearInterval(_timer);loadHandler()}},10)}addEventListener(windowAlias,"load",loadHandler,false)}function getReferrer(){var referrer="";try{referrer=windowAlias.top.document.referrer}catch(e){if(windowAlias.parent){try{referrer=windowAlias.parent.document.referrer}catch(e2){referrer=""}}}if(referrer===""){referrer=documentAlias.referrer}return referrer}function getProtocolScheme(url){var e=new RegExp("^([a-z]+):"),matches=e.exec(url);return matches?matches[1]:null}function getHostName(url){var e=new RegExp("^(?:(?:https?|ftp):)/*(?:[^@]+@)?([^:/#]+)"),matches=e.exec(url);return matches?matches[1]:url}function getParameter(url,name){var e=new RegExp("^(?:https?|ftp)(?::/*(?:[^?]+)[?])([^#]+)"),matches=e.exec(url),f=new RegExp("(?:^|&)"+name+"=([^&]*)"),result=matches?f.exec(matches[1]):0;return result?decodeWrapper(result[1]):""}function utf8_encode(argString){return urldecode(encodeWrapper(argString))}function sha1(str){var rotate_left=function(n,s){return(n<<s)|(n>>>(32-s))},cvt_hex=function(val){var str="",i,v;for(i=7;i>=0;i--){v=(val>>>(i*4))&15;str+=v.toString(16)}return str},blockstart,i,j,W=[],H0=1732584193,H1=4023233417,H2=2562383102,H3=271733878,H4=3285377520,A,B,C,D,E,temp,str_len,word_array=[];str=utf8_encode(str);str_len=str.length;for(i=0;i<str_len-3;i+=4){j=str.charCodeAt(i)<<24|str.charCodeAt(i+1)<<16|str.charCodeAt(i+2)<<8|str.charCodeAt(i+3);word_array.push(j)}switch(str_len&3){case 0:i=2147483648;break;case 1:i=str.charCodeAt(str_len-1)<<24|8388608;break;case 2:i=str.charCodeAt(str_len-2)<<24|str.charCodeAt(str_len-1)<<16|32768;break;case 3:i=str.charCodeAt(str_len-3)<<24|str.charCodeAt(str_len-2)<<16|str.charCodeAt(str_len-1)<<8|128;break}word_array.push(i);while((word_array.length&15)!==14){word_array.push(0)}word_array.push(str_len>>>29);word_array.push((str_len<<3)&4294967295);for(blockstart=0;blockstart<word_array.length;blockstart+=16){for(i=0;i<16;i++){W[i]=word_array[blockstart+i]}for(i=16;i<=79;i++){W[i]=rotate_left(W[i-3]^W[i-8]^W[i-14]^W[i-16],1)}A=H0;B=H1;C=H2;D=H3;E=H4;for(i=0;i<=19;i++){temp=(rotate_left(A,5)+((B&C)|(~B&D))+E+W[i]+1518500249)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=20;i<=39;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+1859775393)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=40;i<=59;i++){temp=(rotate_left(A,5)+((B&C)|(B&D)|(C&D))+E+W[i]+2400959708)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}for(i=60;i<=79;i++){temp=(rotate_left(A,5)+(B^C^D)+E+W[i]+3395469782)&4294967295;E=D;D=C;C=rotate_left(B,30);B=A;A=temp}H0=(H0+A)&4294967295;H1=(H1+B)&4294967295;H2=(H2+C)&4294967295;H3=(H3+D)&4294967295;H4=(H4+E)&4294967295}temp=cvt_hex(H0)+cvt_hex(H1)+cvt_hex(H2)+cvt_hex(H3)+cvt_hex(H4);return temp.toLowerCase()}function urlFixup(hostName,href,referrer){if(hostName==="translate.googleusercontent.com"){if(referrer===""){referrer=href}href=getParameter(href,"u");hostName=getHostName(href)}else{if(hostName==="cc.bingj.com"||hostName==="webcache.googleusercontent.com"||hostName.slice(0,5)==="74.6."){href=documentAlias.links[0].href;hostName=getHostName(href)}}return[hostName,href,referrer]}function domainFixup(domain){var dl=domain.length;if(domain.charAt(--dl)==="."){domain=domain.slice(0,dl)}if(domain.slice(0,2)==="*."){domain=domain.slice(1)}return domain}function titleFixup(title){if(!isString(title)){title=title.text||"";var tmp=documentAlias.getElementsByTagName("title");if(tmp&&isDefined(tmp[0])){title=tmp[0].text}}return title}function isOverlaySession(configTrackerUrl,configTrackerSiteId){var windowName="Piwik_Overlay";var referrer=documentAlias.referrer;var testReferrer=configTrackerUrl;testReferrer=testReferrer.substring(0,testReferrer.length-9);testReferrer.substring(testReferrer.substring(0,7)==="http://"?7:8,testReferrer.length);referrer.substring(referrer.substring(0,7)==="http://"?7:8,referrer.length);if(referrer.substring(0,testReferrer.length)===testReferrer){var referrerRegExp=new RegExp("^"+testReferrer+"index\\.php\\?module=Overlay&action=startOverlaySession&idsite=([0-9]+)&period=([^&]+)&date=([^&]+)$");var match=referrer.match(referrerRegExp);if(match){var idsite=match[1];if(parseInt(idsite,10)!==configTrackerSiteId){return false}var period=match[2];var date=match[3];window.name=windowName+"###"+period+"###"+date}}var windowNameParts=windowAlias.name.split("###");return windowNameParts.length===3&&windowNameParts[0]===windowName}function injectOverlayScripts(configTrackerUrl,configTrackerSiteId){var windowNameParts=window.name.split("###");var root=configTrackerUrl.substring(0,configTrackerUrl.length-9);var period=windowNameParts[1];var date=windowNameParts[2];var loaded=false;var onLoad=function(){if(!loaded){loaded=true;Piwik_Overlay_Client.initialize(root,configTrackerSiteId,period,date)}};var script=document.createElement("script");script.type="text/javascript";script.onreadystatechange=function(){if(this.readyState==="loaded"||this.readyState==="complete"){onLoad()}};script.onload=onLoad;script.src=root+"plugins/Overlay/client/client.js?v=1";var head=document.getElementsByTagName("head")[0];head.appendChild(script)}function Tracker(trackerUrl,siteId){var registeredHooks={},locationArray=urlFixup(documentAlias.domain,windowAlias.location.href,getReferrer()),domainAlias=domainFixup(locationArray[0]),locationHrefAlias=locationArray[1],configReferrerUrl=locationArray[2],configRequestMethod="GET",configTrackerUrl=trackerUrl||"",configTrackerSiteId=siteId||"",configCustomUrl,configTitle=documentAlias.title,configDownloadExtensions="7z|aac|ar[cj]|as[fx]|avi|bin|csv|deb|dmg|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|ms[ip]|od[bfgpst]|og[gv]|pdf|phps|png|ppt|qtm?|ra[mr]?|rpm|sea|sit|tar|t?bz2?|tgz|torrent|txt|wav|wm[av]|wpd||xls|xml|z|zip",configHostsAlias=[domainAlias],configIgnoreClasses=[],configDownloadClasses=[],configLinkClasses=[],configTrackerPause=500,configMinimumVisitTime,configHeartBeatTimer,configDiscardHashTag,configCustomData,configCampaignNameParameters=["pk_campaign","piwik_campaign","utm_campaign","utm_source","utm_medium"],configCampaignKeywordParameters=["pk_kwd","piwik_kwd","utm_term"],configCookieNamePrefix="_pk_",configCookieDomain,configCookiePath,configCookiesDisabled=false,configDoNotTrack,configCountPreRendered,configConversionAttributionFirstReferrer,configVisitorCookieTimeout=63072000000,configSessionCookieTimeout=1800000,configReferralCookieTimeout=15768000000,cookieSecure=documentAlias.location.protocol==="https",customVariables=false,customVariablesPage={},customVariableMaximumLength=200,ecommerceItems={},browserFeatures={},linkTrackingInstalled=false,activityTrackingInstalled=false,lastActivityTime,lastButton,lastTarget,hash=sha1,domainHash,visitorUUID;function setCookie(cookieName,value,msToExpire,path,domain,secure){if(configCookiesDisabled){return}var expiryDate;if(msToExpire){expiryDate=new Date();expiryDate.setTime(expiryDate.getTime()+msToExpire)}documentAlias.cookie=cookieName+"="+encodeWrapper(value)+(msToExpire?";expires="+expiryDate.toGMTString():"")+";path="+(path||"/")+(domain?";domain="+domain:"")+(secure?";secure":"")}function getCookie(cookieName){if(configCookiesDisabled){return 0}var cookiePattern=new RegExp("(^|;)[ ]*"+cookieName+"=([^;]*)"),cookieMatch=cookiePattern.exec(documentAlias.cookie);return cookieMatch?decodeWrapper(cookieMatch[2]):0}function purify(url){var targetPattern;if(configDiscardHashTag){targetPattern=new RegExp("#.*");return url.replace(targetPattern,"")}return url}function resolveRelativeReference(baseUrl,url){var protocol=getProtocolScheme(url),i;if(protocol){return url}if(url.slice(0,1)==="/"){return getProtocolScheme(baseUrl)+"://"+getHostName(baseUrl)+url}baseUrl=purify(baseUrl);if((i=baseUrl.indexOf("?"))>=0){baseUrl=baseUrl.slice(0,i)}if((i=baseUrl.lastIndexOf("/"))!==baseUrl.length-1){baseUrl=baseUrl.slice(0,i+1)}return baseUrl+url}function isSiteHostName(hostName){var i,alias,offset;for(i=0;i<configHostsAlias.length;i++){alias=domainFixup(configHostsAlias[i].toLowerCase());if(hostName===alias){return true}if(alias.slice(0,1)==="."){if(hostName===alias.slice(1)){return true}offset=hostName.length-alias.length;if((offset>0)&&(hostName.slice(offset)===alias)){return true}}}return false}function getImage(request){var image=new Image(1,1);image.onload=function(){};image.src=configTrackerUrl+(configTrackerUrl.indexOf("?")<0?"?":"&")+request}function sendXmlHttpRequest(request){try{var xhr=windowAlias.XMLHttpRequest?new windowAlias.XMLHttpRequest():windowAlias.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;xhr.open("POST",configTrackerUrl,true);xhr.onreadystatechange=function(){if(this.readyState===4&&this.status!==200){getImage(request)}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");xhr.send(request)}catch(e){getImage(request)}}function sendRequest(request,delay){var now=new Date();if(!configDoNotTrack){if(configRequestMethod==="POST"){sendXmlHttpRequest(request)}else{getImage(request)}expireDateTime=now.getTime()+delay}}function getCookieName(baseName){return configCookieNamePrefix+baseName+"."+configTrackerSiteId+"."+domainHash}function hasCookies(){if(configCookiesDisabled){return"0"}if(!isDefined(navigatorAlias.cookieEnabled)){var testCookieName=getCookieName("testcookie");setCookie(testCookieName,"1");return getCookie(testCookieName)==="1"?"1":"0"}return navigatorAlias.cookieEnabled?"1":"0"}function updateDomainHash(){domainHash=hash((configCookieDomain||domainAlias)+(configCookiePath||"/")).slice(0,4)}function getCustomVariablesFromCookie(){var cookieName=getCookieName("cvar"),cookie=getCookie(cookieName);if(cookie.length){cookie=JSON2.parse(cookie);if(isObject(cookie)){return cookie}}return{}}function loadCustomVariables(){if(customVariables===false){customVariables=getCustomVariablesFromCookie()}}function activityHandler(){var now=new Date();lastActivityTime=now.getTime()}function setVisitorIdCookie(uuid,createTs,visitCount,nowTs,lastVisitTs,lastEcommerceOrderTs){setCookie(getCookieName("id"),uuid+"."+createTs+"."+visitCount+"."+nowTs+"."+lastVisitTs+"."+lastEcommerceOrderTs,configVisitorCookieTimeout,configCookiePath,configCookieDomain,cookieSecure)}function loadVisitorIdCookie(){var now=new Date(),nowTs=Math.round(now.getTime()/1000),id=getCookie(getCookieName("id")),tmpContainer;if(id){tmpContainer=id.split(".");tmpContainer.unshift("0")}else{if(!visitorUUID){visitorUUID=hash((navigatorAlias.userAgent||"")+(navigatorAlias.platform||"")+JSON2.stringify(browserFeatures)+nowTs).slice(0,16)}tmpContainer=["1",visitorUUID,nowTs,0,nowTs,"",""]}return tmpContainer}function loadReferrerAttributionCookie(){var cookie=getCookie(getCookieName("ref"));if(cookie.length){try{cookie=JSON2.parse(cookie);if(isObject(cookie)){return cookie}}catch(err){}}return["","",0,""]}function getRequest(request,customData,pluginMethod,currentEcommerceOrderTs){var i,now=new Date(),nowTs=Math.round(now.getTime()/1000),newVisitor,uuid,visitCount,createTs,currentVisitTs,lastVisitTs,lastEcommerceOrderTs,referralTs,referralUrl,referralUrlMaxLength=1024,currentReferrerHostName,originalReferrerHostName,customVariablesCopy=customVariables,idname=getCookieName("id"),sesname=getCookieName("ses"),refname=getCookieName("ref"),cvarname=getCookieName("cvar"),id=loadVisitorIdCookie(),ses=getCookie(sesname),attributionCookie=loadReferrerAttributionCookie(),currentUrl=configCustomUrl||locationHrefAlias,campaignNameDetected,campaignKeywordDetected;if(configCookiesDisabled){configCookiesDisabled=false;setCookie(idname,"",-86400,configCookiePath,configCookieDomain);setCookie(sesname,"",-86400,configCookiePath,configCookieDomain);setCookie(cvarname,"",-86400,configCookiePath,configCookieDomain);setCookie(refname,"",-86400,configCookiePath,configCookieDomain);configCookiesDisabled=true}if(configDoNotTrack){return""}newVisitor=id[0];uuid=id[1];createTs=id[2];visitCount=id[3];currentVisitTs=id[4];lastVisitTs=id[5];if(!isDefined(id[6])){id[6]=""}lastEcommerceOrderTs=id[6];if(!isDefined(currentEcommerceOrderTs)){currentEcommerceOrderTs=""}var charSet=document.characterSet||document.charset;if(!charSet||charSet.toLowerCase()==="utf-8"){charSet=null}campaignNameDetected=attributionCookie[0];campaignKeywordDetected=attributionCookie[1];referralTs=attributionCookie[2];referralUrl=attributionCookie[3];if(!ses){visitCount++;lastVisitTs=currentVisitTs;if(!configConversionAttributionFirstReferrer||!campaignNameDetected.length){for(i in configCampaignNameParameters){if(Object.prototype.hasOwnProperty.call(configCampaignNameParameters,i)){campaignNameDetected=getParameter(currentUrl,configCampaignNameParameters[i]);if(campaignNameDetected.length){break}}}for(i in configCampaignKeywordParameters){if(Object.prototype.hasOwnProperty.call(configCampaignKeywordParameters,i)){campaignKeywordDetected=getParameter(currentUrl,configCampaignKeywordParameters[i]);if(campaignKeywordDetected.length){break}}}}currentReferrerHostName=getHostName(configReferrerUrl);originalReferrerHostName=referralUrl.length?getHostName(referralUrl):"";if(currentReferrerHostName.length&&!isSiteHostName(currentReferrerHostName)&&(!configConversionAttributionFirstReferrer||!originalReferrerHostName.length||isSiteHostName(originalReferrerHostName))){referralUrl=configReferrerUrl}if(referralUrl.length||campaignNameDetected.length){referralTs=nowTs;attributionCookie=[campaignNameDetected,campaignKeywordDetected,referralTs,purify(referralUrl.slice(0,referralUrlMaxLength))];setCookie(refname,JSON2.stringify(attributionCookie),configReferralCookieTimeout,configCookiePath,configCookieDomain,cookieSecure)}}request+="&idsite="+configTrackerSiteId+"&rec=1&r="+String(Math.random()).slice(2,8)+"&h="+now.getHours()+"&m="+now.getMinutes()+"&s="+now.getSeconds()+"&url="+encodeWrapper(purify(currentUrl))+(configReferrerUrl.length?"&urlref="+encodeWrapper(purify(configReferrerUrl)):"")+"&_id="+uuid+"&_idts="+createTs+"&_idvc="+visitCount+"&_idn="+newVisitor+(campaignNameDetected.length?"&_rcn="+encodeWrapper(campaignNameDetected):"")+(campaignKeywordDetected.length?"&_rck="+encodeWrapper(campaignKeywordDetected):"")+"&_refts="+referralTs+"&_viewts="+lastVisitTs+(String(lastEcommerceOrderTs).length?"&_ects="+lastEcommerceOrderTs:"")+(String(referralUrl).length?"&_ref="+encodeWrapper(purify(referralUrl.slice(0,referralUrlMaxLength))):"")+(charSet?"&cs="+encodeWrapper(charSet):"");var customVariablesPageStringified=JSON2.stringify(customVariablesPage);if(customVariablesPageStringified.length>2){request+="&cvar="+encodeWrapper(customVariablesPageStringified)}for(i in browserFeatures){if(Object.prototype.hasOwnProperty.call(browserFeatures,i)){request+="&"+i+"="+browserFeatures[i]}}if(customData){request+="&data="+encodeWrapper(JSON2.stringify(customData))}else{if(configCustomData){request+="&data="+encodeWrapper(JSON2.stringify(configCustomData))}}if(customVariables){var customVariablesStringified=JSON2.stringify(customVariables);if(customVariablesStringified.length>2){request+="&_cvar="+encodeWrapper(customVariablesStringified)}for(i in customVariablesCopy){if(Object.prototype.hasOwnProperty.call(customVariablesCopy,i)){if(customVariables[i][0]===""||customVariables[i][1]===""){delete customVariables[i]}}}setCookie(cvarname,JSON2.stringify(customVariables),configSessionCookieTimeout,configCookiePath,configCookieDomain,cookieSecure)}setVisitorIdCookie(uuid,createTs,visitCount,nowTs,lastVisitTs,isDefined(currentEcommerceOrderTs)&&String(currentEcommerceOrderTs).length?currentEcommerceOrderTs:lastEcommerceOrderTs);setCookie(sesname,"*",configSessionCookieTimeout,configCookiePath,configCookieDomain,cookieSecure);request+=executePluginMethod(pluginMethod);return request}function logEcommerce(orderId,grandTotal,subTotal,tax,shipping,discount){var request="idgoal=0",lastEcommerceOrderTs,now=new Date(),items=[],sku;if(String(orderId).length){request+="&ec_id="+encodeWrapper(orderId);lastEcommerceOrderTs=Math.round(now.getTime()/1000)}request+="&revenue="+grandTotal;if(String(subTotal).length){request+="&ec_st="+subTotal}if(String(tax).length){request+="&ec_tx="+tax}if(String(shipping).length){request+="&ec_sh="+shipping}if(String(discount).length){request+="&ec_dt="+discount}if(ecommerceItems){for(sku in ecommerceItems){if(Object.prototype.hasOwnProperty.call(ecommerceItems,sku)){if(!isDefined(ecommerceItems[sku][1])){ecommerceItems[sku][1]=""}if(!isDefined(ecommerceItems[sku][2])){ecommerceItems[sku][2]=""}if(!isDefined(ecommerceItems[sku][3])||String(ecommerceItems[sku][3]).length===0){ecommerceItems[sku][3]=0}if(!isDefined(ecommerceItems[sku][4])||String(ecommerceItems[sku][4]).length===0){ecommerceItems[sku][4]=1}items.push(ecommerceItems[sku])}}request+="&ec_items="+encodeWrapper(JSON2.stringify(items))}request=getRequest(request,configCustomData,"ecommerce",lastEcommerceOrderTs);sendRequest(request,configTrackerPause)}function logEcommerceOrder(orderId,grandTotal,subTotal,tax,shipping,discount){if(String(orderId).length&&isDefined(grandTotal)){logEcommerce(orderId,grandTotal,subTotal,tax,shipping,discount)}}function logEcommerceCartUpdate(grandTotal){if(isDefined(grandTotal)){logEcommerce("",grandTotal,"","","","")}}function logPageView(customTitle,customData){var now=new Date(),request=getRequest("action_name="+encodeWrapper(titleFixup(customTitle||configTitle)),customData,"log");sendRequest(request,configTrackerPause);if(configMinimumVisitTime&&configHeartBeatTimer&&!activityTrackingInstalled){activityTrackingInstalled=true;addEventListener(documentAlias,"click",activityHandler);addEventListener(documentAlias,"mouseup",activityHandler);addEventListener(documentAlias,"mousedown",activityHandler);addEventListener(documentAlias,"mousemove",activityHandler);addEventListener(documentAlias,"mousewheel",activityHandler);addEventListener(windowAlias,"DOMMouseScroll",activityHandler);addEventListener(windowAlias,"scroll",activityHandler);addEventListener(documentAlias,"keypress",activityHandler);addEventListener(documentAlias,"keydown",activityHandler);addEventListener(documentAlias,"keyup",activityHandler);addEventListener(windowAlias,"resize",activityHandler);addEventListener(windowAlias,"focus",activityHandler);addEventListener(windowAlias,"blur",activityHandler);lastActivityTime=now.getTime();setTimeout(function heartBeat(){var now=new Date(),request;if((lastActivityTime+configHeartBeatTimer)>now.getTime()){if(configMinimumVisitTime<now.getTime()){request=getRequest("ping=1",customData,"ping");sendRequest(request,configTrackerPause)}setTimeout(heartBeat,configHeartBeatTimer)}},configHeartBeatTimer)}}function logSiteSearch(keyword,category,resultsCount,customData){var request=getRequest("search="+encodeWrapper(keyword)+(category?"&search_cat="+encodeWrapper(category):"")+(isDefined(resultsCount)?"&search_count="+resultsCount:""),customData,"sitesearch");sendRequest(request,configTrackerPause)}function logGoal(idGoal,customRevenue,customData){var request=getRequest("idgoal="+idGoal+(customRevenue?"&revenue="+customRevenue:""),customData,"goal");sendRequest(request,configTrackerPause)}function logLink(url,linkType,customData){var request=getRequest(linkType+"="+encodeWrapper(purify(url)),customData,"link");sendRequest(request,configTrackerPause)}function prefixPropertyName(prefix,propertyName){if(prefix!==""){return prefix+propertyName.charAt(0).toUpperCase()+propertyName.slice(1)}return propertyName}function trackCallback(callback){var isPreRendered,i,prefixes=["","webkit","ms","moz"],prefix;if(!configCountPreRendered){for(i=0;i<prefixes.length;i++){prefix=prefixes[i];if(Object.prototype.hasOwnProperty.call(documentAlias,prefixPropertyName(prefix,"hidden"))){if(documentAlias[prefixPropertyName(prefix,"visibilityState")]==="prerender"){isPreRendered=true}break}}}if(isPreRendered){addEventListener(documentAlias,prefix+"visibilitychange",function ready(){documentAlias.removeEventListener(prefix+"visibilitychange",ready,false);callback()});return}callback()}function getClassesRegExp(configClasses,defaultClass){var i,classesRegExp="(^| )(piwik[_-]"+defaultClass;if(configClasses){for(i=0;i<configClasses.length;i++){classesRegExp+="|"+configClasses[i]}}classesRegExp+=")( |$)";return new RegExp(classesRegExp)}function getLinkType(className,href,isInLink){var downloadPattern=getClassesRegExp(configDownloadClasses,"download"),linkPattern=getClassesRegExp(configLinkClasses,"link"),downloadExtensionsPattern=new RegExp("\\.("+configDownloadExtensions+")([?&#]|$)","i");return linkPattern.test(className)?"link":(downloadPattern.test(className)||downloadExtensionsPattern.test(href)?"download":(isInLink?0:"link"))}function processClick(sourceElement){var parentElement,tag,linkType;while((parentElement=sourceElement.parentNode)!==null&&isDefined(parentElement)&&((tag=sourceElement.tagName.toUpperCase())!=="A"&&tag!=="AREA")){sourceElement=parentElement}if(isDefined(sourceElement.href)){var originalSourceHostName=sourceElement.hostname||getHostName(sourceElement.href),sourceHostName=originalSourceHostName.toLowerCase(),sourceHref=sourceElement.href.replace(originalSourceHostName,sourceHostName),scriptProtocol=new RegExp("^(javascript|vbscript|jscript|mocha|livescript|ecmascript|mailto):","i");if(!scriptProtocol.test(sourceHref)){linkType=getLinkType(sourceElement.className,sourceHref,isSiteHostName(sourceHostName));if(linkType){sourceHref=urldecode(sourceHref);logLink(sourceHref,linkType)}}}}function clickHandler(evt){var button,target;evt=evt||windowAlias.event;button=evt.which||evt.button;target=evt.target||evt.srcElement;if(evt.type==="click"){if(target){processClick(target)}}else{if(evt.type==="mousedown"){if((button===1||button===2)&&target){lastButton=button;lastTarget=target}else{lastButton=lastTarget=null}}else{if(evt.type==="mouseup"){if(button===lastButton&&target===lastTarget){processClick(target)}lastButton=lastTarget=null}}}}function addClickListener(element,enable){if(enable){addEventListener(element,"mouseup",clickHandler,false);addEventListener(element,"mousedown",clickHandler,false)}else{addEventListener(element,"click",clickHandler,false)}}function addClickListeners(enable){if(!linkTrackingInstalled){linkTrackingInstalled=true;var i,ignorePattern=getClassesRegExp(configIgnoreClasses,"ignore"),linkElements=documentAlias.links;if(linkElements){for(i=0;i<linkElements.length;i++){if(!ignorePattern.test(linkElements[i].className)){addClickListener(linkElements[i],enable)}}}}}function detectBrowserFeatures(){var i,mimeType,pluginMap={pdf:"application/pdf",qt:"video/quicktime",realp:"audio/x-pn-realaudio-plugin",wma:"application/x-mplayer2",dir:"application/x-director",fla:"application/x-shockwave-flash",java:"application/x-java-vm",gears:"application/x-googlegears",ag:"application/x-silverlight"},devicePixelRatio=(new RegExp("Mac OS X.*Safari/")).test(navigatorAlias.userAgent)?windowAlias.devicePixelRatio||1:1;if(!((new RegExp("MSIE")).test(navigatorAlias.userAgent))){if(navigatorAlias.mimeTypes&&navigatorAlias.mimeTypes.length){for(i in pluginMap){if(Object.prototype.hasOwnProperty.call(pluginMap,i)){mimeType=navigatorAlias.mimeTypes[pluginMap[i]];browserFeatures[i]=(mimeType&&mimeType.enabledPlugin)?"1":"0"}}}if(typeof navigator.javaEnabled!=="unknown"&&isDefined(navigatorAlias.javaEnabled)&&navigatorAlias.javaEnabled()){browserFeatures.java="1"}if(isFunction(windowAlias.GearsFactory)){browserFeatures.gears="1"}browserFeatures.cookie=hasCookies()}browserFeatures.res=screenAlias.width*devicePixelRatio+"x"+screenAlias.height*devicePixelRatio}function registerHook(hookName,userHook){var hookObj=null;if(isString(hookName)&&!isDefined(registeredHooks[hookName])&&userHook){if(isObject(userHook)){hookObj=userHook}else{if(isString(userHook)){try{eval("hookObj ="+userHook)}catch(e){}}}registeredHooks[hookName]=hookObj}return hookObj}detectBrowserFeatures();updateDomainHash();executePluginMethod("run",registerHook);return{hook:registeredHooks,getHook:function(hookName){return registeredHooks[hookName]},getVisitorId:function(){return(loadVisitorIdCookie())[1]},getVisitorInfo:function(){return loadVisitorIdCookie()},getAttributionInfo:function(){return loadReferrerAttributionCookie()},getAttributionCampaignName:function(){return loadReferrerAttributionCookie()[0]},getAttributionCampaignKeyword:function(){return loadReferrerAttributionCookie()[1]},getAttributionReferrerTimestamp:function(){return loadReferrerAttributionCookie()[2]},getAttributionReferrerUrl:function(){return loadReferrerAttributionCookie()[3]},setTrackerUrl:function(trackerUrl){configTrackerUrl=trackerUrl},setSiteId:function(siteId){configTrackerSiteId=siteId},setCustomData:function(key_or_obj,opt_value){if(isObject(key_or_obj)){configCustomData=key_or_obj}else{if(!configCustomData){configCustomData=[]}configCustomData[key_or_obj]=opt_value}},getCustomData:function(){return configCustomData},setCustomVariable:function(index,name,value,scope){var toRecord;if(!isDefined(scope)){scope="visit"}if(index>0){name=isDefined(name)&&!isString(name)?String(name):name;value=isDefined(value)&&!isString(value)?String(value):value;toRecord=[name.slice(0,customVariableMaximumLength),value.slice(0,customVariableMaximumLength)];if(scope==="visit"||scope===2){loadCustomVariables();customVariables[index]=toRecord}else{if(scope==="page"||scope===3){customVariablesPage[index]=toRecord}}}},getCustomVariable:function(index,scope){var cvar;if(!isDefined(scope)){scope="visit"}if(scope==="page"||scope===3){cvar=customVariablesPage[index]}else{if(scope==="visit"||scope===2){loadCustomVariables();cvar=customVariables[index]}}if(!isDefined(cvar)||(cvar&&cvar[0]==="")){return false}return cvar},deleteCustomVariable:function(index,scope){if(this.getCustomVariable(index,scope)){this.setCustomVariable(index,"","",scope)}},setLinkTrackingTimer:function(delay){configTrackerPause=delay},setDownloadExtensions:function(extensions){configDownloadExtensions=extensions},addDownloadExtensions:function(extensions){configDownloadExtensions+="|"+extensions},setDomains:function(hostsAlias){configHostsAlias=isString(hostsAlias)?[hostsAlias]:hostsAlias;configHostsAlias.push(domainAlias)},setIgnoreClasses:function(ignoreClasses){configIgnoreClasses=isString(ignoreClasses)?[ignoreClasses]:ignoreClasses},setRequestMethod:function(method){configRequestMethod=method||"GET"},setReferrerUrl:function(url){configReferrerUrl=url},setCustomUrl:function(url){configCustomUrl=resolveRelativeReference(locationHrefAlias,url)},setDocumentTitle:function(title){configTitle=title},setDownloadClasses:function(downloadClasses){configDownloadClasses=isString(downloadClasses)?[downloadClasses]:downloadClasses},setLinkClasses:function(linkClasses){configLinkClasses=isString(linkClasses)?[linkClasses]:linkClasses},setCampaignNameKey:function(campaignNames){configCampaignNameParameters=isString(campaignNames)?[campaignNames]:campaignNames},setCampaignKeywordKey:function(campaignKeywords){configCampaignKeywordParameters=isString(campaignKeywords)?[campaignKeywords]:campaignKeywords},discardHashTag:function(enableFilter){configDiscardHashTag=enableFilter},setCookieNamePrefix:function(cookieNamePrefix){configCookieNamePrefix=cookieNamePrefix;customVariables=getCustomVariablesFromCookie()},setCookieDomain:function(domain){configCookieDomain=domainFixup(domain);updateDomainHash()},setCookiePath:function(path){configCookiePath=path;updateDomainHash()},setVisitorCookieTimeout:function(timeout){configVisitorCookieTimeout=timeout*1000},setSessionCookieTimeout:function(timeout){configSessionCookieTimeout=timeout*1000},setReferralCookieTimeout:function(timeout){configReferralCookieTimeout=timeout*1000},setConversionAttributionFirstReferrer:function(enable){configConversionAttributionFirstReferrer=enable},disableCookies:function(){configCookiesDisabled=true;browserFeatures.cookie="0"},setDoNotTrack:function(enable){var dnt=navigatorAlias.doNotTrack||navigatorAlias.msDoNotTrack;configDoNotTrack=enable&&(dnt==="yes"||dnt==="1");if(configDoNotTrack){this.disableCookies()}},addListener:function(element,enable){addClickListener(element,enable)},enableLinkTracking:function(enable){if(hasLoaded){addClickListeners(enable)}else{registeredOnLoadHandlers.push(function(){addClickListeners(enable)})}},setHeartBeatTimer:function(minimumVisitLength,heartBeatDelay){var now=new Date();configMinimumVisitTime=now.getTime()+minimumVisitLength*1000;configHeartBeatTimer=heartBeatDelay*1000},killFrame:function(){if(windowAlias.location!==windowAlias.top.location){windowAlias.top.location=windowAlias.location}},redirectFile:function(url){if(windowAlias.location.protocol==="file:"){windowAlias.location=url}},setCountPreRendered:function(enable){configCountPreRendered=enable},trackGoal:function(idGoal,customRevenue,customData){trackCallback(function(){logGoal(idGoal,customRevenue,customData)})},trackLink:function(sourceUrl,linkType,customData){trackCallback(function(){logLink(sourceUrl,linkType,customData)})},trackPageView:function(customTitle,customData){if(isOverlaySession(configTrackerUrl,configTrackerSiteId)){trackCallback(function(){injectOverlayScripts(configTrackerUrl,configTrackerSiteId)})}else{trackCallback(function(){logPageView(customTitle,customData)})}},trackSiteSearch:function(keyword,category,resultsCount){trackCallback(function(){logSiteSearch(keyword,category,resultsCount)})},setEcommerceView:function(sku,name,category,price){if(!isDefined(category)||!category.length){category=""}else{if(category instanceof Array){category=JSON2.stringify(category)}}customVariablesPage[5]=["_pkc",category];if(isDefined(price)&&String(price).length){customVariablesPage[2]=["_pkp",price]}if((!isDefined(sku)||!sku.length)&&(!isDefined(name)||!name.length)){return}if(isDefined(sku)&&sku.length){customVariablesPage[3]=["_pks",sku]}if(!isDefined(name)||!name.length){name=""}customVariablesPage[4]=["_pkn",name]},addEcommerceItem:function(sku,name,category,price,quantity){if(sku.length){ecommerceItems[sku]=[sku,name,category,price,quantity]}},trackEcommerceOrder:function(orderId,grandTotal,subTotal,tax,shipping,discount){logEcommerceOrder(orderId,grandTotal,subTotal,tax,shipping,discount)},trackEcommerceCartUpdate:function(grandTotal){logEcommerceCartUpdate(grandTotal)}}}function TrackerProxy(){return{push:apply}}addEventListener(windowAlias,"beforeunload",beforeUnloadHandler,false);addReadyListener();Date.prototype.getTimeAlias=Date.prototype.getTime;asyncTracker=new Tracker();for(i=0;i<_paq.length;i++){apply(_paq[i])}_paq=new TrackerProxy();return{addPlugin:function(pluginName,pluginObj){plugins[pluginName]=pluginObj},getTracker:function(piwikUrl,siteId){return new Tracker(piwikUrl,siteId)},getAsyncTracker:function(){return asyncTracker}}}()),piwik_track,piwik_log=function(documentTitle,siteId,piwikUrl,customData){function getOption(optionName){try{return eval("piwik_"+optionName)}catch(e){}return}var option,piwikTracker=Piwik.getTracker(piwikUrl,siteId);piwikTracker.setDocumentTitle(documentTitle);piwikTracker.setCustomData(customData);option=getOption("tracker_pause");if(option){piwikTracker.setLinkTrackingTimer(option)}option=getOption("download_extensions");if(option){piwikTracker.setDownloadExtensions(option)}option=getOption("hosts_alias");if(option){piwikTracker.setDomains(option)}option=getOption("ignore_classes");if(option){piwikTracker.setIgnoreClasses(option)}piwikTracker.trackPageView();if(getOption("install_tracker")){piwik_track=function(sourceUrl,siteId,piwikUrl,linkType){piwikTracker.setSiteId(siteId);piwikTracker.setTrackerUrl(piwikUrl);piwikTracker.trackLink(sourceUrl,linkType)};piwikTracker.enableLinkTracking()}};

/* purl.js */
;(function(factory){if(typeof define==="function"&&define.amd){if(typeof jQuery!=="undefined"){define(["jquery"],factory)}else{define([],factory)}}else{if(typeof jQuery!=="undefined"){factory(jQuery)}else{factory()}}})(function($,undefined){var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},toString=Object.prototype.toString,isint=/^[0-9]+$/;function parseUri(url,strictMode){var str=decodeURI(url),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param.query=parseString(uri.attr.query);uri.param.fragment=parseString(uri.attr.fragment);uri.seg.path=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/");uri.seg.fragment=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");uri.attr.base=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"";return uri}function getAttrName(elm){var tn=elm.tagName;if(typeof tn!=="undefined"){return tag2attr[tn.toLowerCase()]}return tn}function promote(parent,key){if(parent[key].length==0){return parent[key]={}}var t={};for(var i in parent[key]){t[i]=parent[key][i]}parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(!part){if(isArray(parent[key])){parent[key].push(val)}else{if("object"==typeof parent[key]){parent[key]=val}else{if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!=val){obj.push(val)}}else{if("object"==typeof obj){obj[keys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}}else{if(~part.indexOf("]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj)){obj=promote(parent,key)}parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj)){obj=promote(parent,key)}parse(parts,obj,part,val)}}}}function merge(parent,key,val){if(~key.indexOf("]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base){t[k]=parent.base[k]}parent.base=t}set(parent.base,key,val)}return parent}function parseString(str){return reduce(String(str).split(/&|;/),function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g," "))}catch(e){}var eql=pair.indexOf("="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(val.indexOf("=")+1,val.length);if(""==key){key=pair,val=""}return merge(ret,key,val)},{base:{}}).base}function set(obj,key,val){var v=obj[key];if(undefined===v){obj[key]=val}else{if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c){brace=false}if("["==c){brace=true}if("="==c&&!brace){return i}}}function reduce(obj,accumulator){var i=0,l=obj.length>>0,curr=arguments[2];while(i<l){if(i in obj){curr=accumulator.call(undefined,curr,obj[i],i,obj)}++i}return curr}function isArray(vArg){return Object.prototype.toString.call(vArg)==="[object Array]"}function keys(obj){var keys=[];for(prop in obj){if(obj.hasOwnProperty(prop)){keys.push(prop)}}return keys}function purl(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return typeof attr!=="undefined"?this.data.attr[attr]:this.data.attr},param:function(param){return typeof param!=="undefined"?this.data.param.query[param]:this.data.param.query},fparam:function(param){return typeof param!=="undefined"?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(typeof seg==="undefined"){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(typeof seg==="undefined"){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}if(typeof $!=="undefined"){$.fn.url=function(strictMode){var url="";if(this.length){url=$(this).attr(getAttrName(this[0]))||""}return purl(url,strictMode)};$.url=purl}else{window.purl=purl}});

/* JSON function fixer */
if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());

/* Bookt API 03-08-2013 */
var BAPI = BAPI || {};

(function(context) {

context.defaultOptions = {
    language: '{{Culture.Name}}',
	languageISO: '{{Culture.TwoLetterISOLanguageName}}',
	dateFormat: '{{Culture.DateTimeFormat.ShortDatePattern}}',
	dateFormatMoment: function() { return context.defaultOptions.dateFormat.toUpperCase(); },
	dateFormatBAPI: 'MM-DD-YYYY',
    currency: 'USD',
    baseURL: 'https://connect.bookt.com',
    apikey: null,
    logging: true,
	jsonp: true
};

context.entities = {
    property: 'property',
    development: 'development',
    poi: 'poi',
	doctemplate: 'doctemplate',
	leads: 'leads',
	leadactivity: 'leadactivity',
	searches: 'searches',
	booking: 'booking',
	specials: 'specials',
	marketarea: 'marketarea',
	fee: 'fee',
	tax: 'tax'
}

context.initialized = false;
context.reqid = null;
context.stime = new Date();
context.etime = new Date();
context.init = function (apikey, options) {
	if (context.initialized) { return; }
	context.initialized = true;	
    this.defaultOptions.apikey = apikey;
	
	context.reqid = $("meta[name=REQUESTID]").attr("content");
	if (context.reqid === null) { context.reqid = guid(); }
	
    if (typeof apikey === "undefined" || apikey === null) {
        context.defaultOptions.baseURL = '/misc';
	}
	if (typeof(options) === "undefined" || options === null) { options = new Object(); }	
	if (typeof(options.baseURL) !== "undefined") { context.defaultOptions.baseURL = options.baseURL;	}		
	if (typeof(options.jsonp) !== "undefined") { 
		context.defaultOptions.jsonp = options.jsonp; 
	}
		
	context.loadsession();	
}

$(window).load(function() {
	context.session().lasteventtime = new Date();		
	context.savesession();
	// do logging
	context.etime = new Date();
	var t = (context.etime - context.stime);
	context.logging.logpageview(t);	
});

/* Session */
function PersonProfile() {
	this.visitorid = null;
	this.visitorid2 = null;
	this.personid = null;
	this.fname = null;
	this.lname = null;
	this.email = null;
	this.phone = null;
	this.address1 = null;
	this.address2 = null;
	this.city = null;
	this.state = null;
	this.postalcode = null;
	this.country = null;
	this.leadsource = null;
}

function SessionProfile() {
	this.visitorid = 0;
	this.visitorid2 = {{Visit.Current.VisitorID}};
	this.personid = {{Visit.Current.PersonID}};
	this.profiledata = [ new PersonProfile() ];
	this.profiles = {
		current: function() { return this.profiledata[0]; }
	};
	this.searchmode = 0;
	this.searchparams = new SearchParams();		
	this.currency = context.defaultOptions.currency;		
	this.favorites = {
		add: function(id, callback) {			
			var url = context.defaultOptions.baseURL + '/ws/' + '?method=create&entity=favorites&id=' + id;
			context.utils.getJSON2(url, function (data) { callback(data); }, false);	
		},
		del: function(id, callback) {
			var url = context.defaultOptions.baseURL + '/ws/' + '?method=delete&entity=favorites&id=' + id;
			context.utils.getJSON2(url, function (data) { callback(data); }, false);	
		},
		clear: function(callback) {
			var url = context.defaultOptions.baseURL + '/ws/' + '?method=delete&entity=favorites&clearall=1';
			context.utils.getJSON2(url, function (data) { callback(data); }, false);	
		},		
		list: function(callback) {
			var url = context.defaultOptions.baseURL + '/ws/' + '?method=get&entity=favorites';
			context.utils.getJSON2(url, function (data) { callback(data); }, false);	
		}
	}
}

function SearchParams() {
	this.checkin = null;
	this.checkout = null;
	this.scheckin = null;
	this.scheckout = null;
	this.los = null;
	this.adults = new MultiSearchParam();
	this.children = new MultiSearchParam();
	this.beds = new MultiSearchParam();
	this.baths = new MultiSearchParam();
	this.sleeps = new MultiSearchParam();
	this.rooms = new MultiSearchParam();
	this.category = null;
	this.location = null;
	this.altid = null;
	this.dev = null;
	this.amenities = null;
	this.headline = null;
	this.rate = new MultiSearchParam();	
}

function MultiSearchParam() {
	this.exactly = null; 
	this.min = null; 
	this.max = null; 
}

var _cookiename = 'BAPI';
var _session = new SessionProfile();
context.session = function() {
	return _session;
}
context.loadsession = function() {		
	//var a = JSON.parse($.cookie(_cookiename));
	var a = $.parseJSON($.cookie(_cookiename));
	if (typeof (a) === "undefined" || a === null) {
		context.log("Creating new BAPI session.");
		_session = new SessionProfile();
	}	
	else {
		_session.visitorid = a.visitorid;
		_session.visitorid2 = a.visitorid2;
		_session.personid = a.personid;
		_session.searchmode = a.searchmode;
		_session.currency = (typeof(a.currency) === "undefined" || a.currency === null ? context.defaultOptions.currency : a.currency);
		_session.searchparams.checkin = a.searchparams.checkin;
		_session.searchparams.checkout = a.searchparams.checkout;
		_session.searchparams.los = a.searchparams.los;
		_session.searchparams.adults = (typeof(a.searchparams.adults) === "undefined" || a.searchparams.adults === null ? new MultiSearchParam() : a.searchparams.adults);
		_session.searchparams.children = (typeof(a.searchparams.children) === "undefined" || a.searchparams.children === null ? new MultiSearchParam() : a.searchparams.children);
		_session.searchparams.beds = (typeof(a.searchparams.beds) === "undefined" || a.searchparams.beds === null ? new MultiSearchParam() : a.searchparams.beds);
		_session.searchparams.baths = (typeof(a.searchparams.baths) === "undefined" || a.searchparams.baths === null ? new MultiSearchParam() : a.searchparams.baths);
		_session.searchparams.sleeps = (typeof(a.searchparams.sleeps) === "undefined" || a.searchparams.sleeps === null ? new MultiSearchParam() : a.searchparams.sleeps);
		_session.searchparams.rooms = (typeof(a.searchparams.rooms) === "undefined" || a.searchparams.rooms === null ? new MultiSearchParam() : a.searchparams.rooms);
		_session.searchparams.category = a.searchparams.category;
		_session.searchparams.location = a.searchparams.location;
		_session.searchparams.altid = a.searchparams.altid;
		_session.searchparams.dev = a.searchparams.dev;
		_session.searchparams.amenities = a.searchparams.amenities;
		_session.searchparams.headline = a.searchparams.headline;
		_session.searchparams.rate = (typeof(a.searchparams.rate) === "undefined" || a.searchparams.rate === null ? new MultiSearchParam() : a.searchparams.rate);		
	}
	
	// cleanup the checkin/checkout dates
	cleanupSearchParams();	
	
	// update the visitorID to be the client one
	if (_pt == null) { context.logging.init(); }
	if (_pt!=null) { _session.visitorid = _pt.getVisitorId(); }
	
}

function isEmptyDate(s) {
	return (typeof(s)==="undefined" || s===null || s=='');
}
context.savesession = function() {	
	var s = _session;
	var sp = _session.searchparams;
	var df = context.defaultOptions.dateFormatBAPI;
	var dfparse = context.defaultOptions.dateFormatMoment();
	var mind = moment(context.config().minbookingdate);
	var maxd = moment(context.config().maxbookingdate);
	//BAPI.log("->mind=" + mind.format(df) + ", maxd=" + maxd.format(df));	
	
	// set the checkin
	if (sp.scheckin===null || sp.scheckin=='') {
		sp.checkin = null;
	}
	else {		
		sp.checkin = moment(sp.scheckin, dfparse); // set the checkin to whatever was in the display version
		//BAPI.log("->parsed checkin=" + sp.checkin.format(df));
		if (sp.checkin.isBefore(mind)) { sp.checkin = mind; } // make sure the checkin is great than the minbookingdate
		if (sp.checkin.isAfter(maxd)) { sp.checkin = mind; } // make sure the checkin is before the maxbookingdate
		sp.checkin = moment(sp.checkin).format(df); // format to bapi default dateformat
	}
	
	// set the checkout
	if (sp.scheckout===null || sp.scheckout=='') {
		sp.checkout = null;
	}
	else {
		sp.checkout = moment(sp.scheckout, dfparse); // set the checkout to whatever was in the display version		
		//BAPI.log("->parsed checkout=" + sp.checkout.format(df));
		if (sp.checkout.isSame(sp.checkin) || sp.checkout.isBefore(sp.checkn)) { // make sure the checkout is great than the checkin
			sp.checkoout = moment(sp.checkin).add("days", context.config().minlos);
		}
		sp.checkout = moment(sp.checkout).format(df); // format to bapi default dateformat
	}
	//context.log("--In savesession--"); context.log(_session);	
	$.cookie(_cookiename, JSON.stringify(s),  { expires: 30, path: '/' }); 
}	
context.clearsession = function() {	
	_session = new SessionProfile();
	context.savesession();	
}

/* Logging */
context.log = function (a) {
    if (context.defaultOptions.logging) { if (typeof (console) !== "undefined") { console.log(a); } }
}

/* CRUD */
context.save = function(entity, postdata, callback) {	
    var url = context.defaultOptions.baseURL + '/ws/' + '?method=save' + '&entity=' + entity;                                            
	context.utils.dopost(url, postdata, function (data) { 
		callback(data); 
	})
}

context.search = function (entity, options, callback) {
    if (typeof(options) === "undefined" || options === null) { options = new Object(); }
	if (typeof(options.currency) === "undefined" || options.currency === null) { options.currency = context.session().currency; }
	if (typeof(options.currency) === "undefined" || options.currency === null) { options.currency = context.defaultOptions.currency; }
    var optionsURL = jQuery.param(options);        
    var url = context.defaultOptions.baseURL + '/ws/' + '?method=search' + '&entity=' + entity + '&' + optionsURL;                                            
	context.utils.getJSON2(url, function (data) { callback(data); }, true);	
}

context.get = function (ids, entity, options, callback) {
	if (typeof (ids) === "undefined" || ids === null || ids.length === 0) { callback("ids not specified."); return; }
    if (typeof(options) === "undefined" || options === null) { options = new Object(); }
	if (typeof (options.page) === "undefined" || options.page === null || options.page <= 0) { options.page = 1; }
	if (typeof (options.pagesize) === "undefined" || options.pagesize === null || options.pagesize <= 0) { options.pagesize = 5; }	
	if (typeof(options.currency) === "undefined" || options.currency === null) { options.currency = context.session().currency; }
	if (typeof(options.currency) === "undefined" || options.currency === null) { options.currency = context.defaultOptions.currency; }
	var si = (options.page-1) * options.pagesize;
	var ei = si + options.pagesize;
	var nids = [].concat(ids).slice(si, ei);	
	var optionsURL = jQuery.param(options);
	var url = context.defaultOptions.baseURL + '/ws/' + '?method=get' + '&ids=' + nids + '&entity=' + entity + '&' + optionsURL;                                          
	context.utils.getJSON2(url, function (data) { callback(data); }, true);
}

context.del = function (ids, entity, options, callback) {
}

context.createevent = function (options, callback) {
	if (callback === null) { return; }
    if (typeof (options) === "undefined" || options === null) { options = { "empty": true }; }
    var optionsURL = jQuery.param(options);
    var url = context.defaultOptions.baseURL + '/ws/' + '?method=createevent' + '&' + optionsURL;                                            
	context.utils.getJSON2(url, function (data) { 
		if (data !== null && data.result !== null) {
			context.session().personid = data.result.Lead.ID;
			context.savesession();
		}
		callback(data); 
	}, false);				
}

var _config = {{{Config}}};
context.config = function() { 
	return _config.result;
}

context.site = {
	siteid: {{#SiteID}}{{SiteID}}{{/SiteID}}{{^SiteID}}0{{/SiteID}},
	solutionid: {{#SolutionID}}{{SolutionID}}{{/SolutionID}}{{^SolutionID}}0{{/SolutionID}},
	url: '{{PrimaryURL}}',
	slideshowimages: [
{{#Site.SlideShowImages}}
			{ imgurl: '{{OriginalURL}}', caption: '{{Caption}}' },
{{/Site.SlideShowImages}}
{{^Site.SlideShowImages}}
			{ imgurl: 'http://booktplatform.s3.amazonaws.com/shared/defaultslideshow/1.jpg', caption: '' },
			{ imgurl: 'http://booktplatform.s3.amazonaws.com/shared/defaultslideshow/2.jpg', caption: '' },
			{ imgurl: 'http://booktplatform.s3.amazonaws.com/shared/defaultslideshow/3.jpg', caption: '' },
			{ imgurl: 'http://booktplatform.s3.amazonaws.com/shared/defaultslideshow/4.jpg', caption: '' }
			{{/Site.SlideShowImages}}],
	solutionname: '{{SolutionName}}',
	solutionnameinformal: '{{SolutionNameInformal}}',	
	logo: '{{SolutionLogo}}',
	summary: '{{SolutionSummary}}',
	tagline: '{{SolutionTagline}}',
	office: {
		Address1: '{{Office.Address1}}',
		Address2: '{{Office.Address2}}',
		City: '{{Office.City}}',
		State: '{{Office.State}}',
		County: '{{Office.County}}',
		Neighborhood: '{{Office.Neighborhood}}',
		Country: '{{Office.Country}}',
		Longitude: {{Office.Longitude}},
		Latitude: {{Office.Latitude}}
	},
	email: '{{PrimaryEmail}}',
	phone: '{{PrimaryPhone}}'
}

/* Templates */
context.templates = {
	all: function() { return _config.result.templates; },
	get: function(tmpl) { return $($.parseHTML(context.config().templates)).filter('#' + tmpl).html(); }
}

/* Logging */
var _pt = null;
context.logging = {	
	init: function() {
{{#InConnect}}
		if (context.defaultOptions.baseURL == "/misc") { return; }  // not logging for legacy
		var url = context.defaultOptions.baseURL + '/ws/' + '?method=log&apikey=' + context.defaultOptions.apikey;		
		_pt = Piwik.getTracker(url, 1);
		_pt.setSiteId(context.site.siteid);
{{/InConnect}}
	},
	logpageview: function(t) {
{{#InConnect}}
		try {
		if (context.defaultOptions.baseURL == "/misc") { return; } // not logging for legacy
		if (_pt == null) { context.logging.init(); }
		context.log('Page took ' + t + 'ms.');		
		_pt.setCustomVariable(1, "msloadtime", t);
		_pt.trackPageView();				
		} catch(err) { context.log(err); }
{{/InConnect}}
	},
	pt: function() {
		return _pt;
	}
}

/* Debug Methods */
context.showclientinfo = function (callback) {
	if (callback === null) { return; }
	var url = context.defaultOptions.baseURL + '/ws/' + '?method=showclientinfo';
	context.utils.getJSON2(url, function (data) { callback(data); }, true);				
}

/* Utilities */
context.utils = {
	jsondate: function(s) {
		if (typeof(s) === "undefined" || s === null) { return null; }
		try { return new Date(parseFloat(/Date\(([^)]+)\)/.exec(s)[1])); }
		catch(err) { return null; }
	},
	loadStyleSheet: function (url) {
		$('head').append('<link rel="stylesheet" type="text/css" href="' + url + '">');		
	},
	loadScript: function (url, callback) {
		$.ajax({
			type: "GET",
			url: url,
			success: callback,
			dataType: "script",
			cache: true,
			async: false
		});		
	},
	getJSON: function (url, callback, cache) {
		$.ajax({
			url: url,
			dataType: 'jsonp',
			success: callback,
			cache: true
		});
	},
	getJSON2: function (url, callback, cache) {
		url = url + '&apikey=' + context.defaultOptions.apikey + '&language=' + context.defaultOptions.language;
		if (context.defaultOptions.jsonp) {
			url = url + '&callback=?';
			$.getJSON(url, function (data) {
				callback(data); 
			});
		}
		else {		
			$.ajax({
				url: window.location.protocol + '//' + window.location.host + url,
				dataType: 'json',
				success: callback,
				cache: cache
			});
		}		
	},
	dopost: function (url, postdata, callback) {
		var posting = $.post( url, postdata );		
		posting.done(function( res ) {
			if (typeof(callback)!=="undefined" && callback!=null) {
				callback(res);
			}			
		});
	},
	datepart: function(s) {
		var t = moment(s);
		return moment([t.year(), t.month(), t.day()]);
	}
}

function S4() {
   return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
}
function guid() {
   return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());
}
function hash(str) {
    var hash = 0;
    for (i = 0; i < str.length; i++) {
        var c = str.charCodeAt(i);
        hash = c + (hash << 6) + (hash << 16) - hash;
    }
    return hash;
}
function cleanupSearchParams() {
	var mind = moment(context.config().minbookingdate);
	var maxd = moment(context.config().maxbookingdate);
	var df = context.defaultOptions.dateFormatBAPI;
	var dfparse = context.defaultOptions.dateFormatMoment();
	var s = _session;
	var sp = _session.searchparams;
	
	// fixup the checkin (data)
	if (typeof(sp.checkin)==="undefined") { sp.checkin = null; }
	if (typeof(sp.checkout)==="undefined") { sp.checkout = null; }
	if (sp.checkin!==null && sp.checkin!='' && moment(sp.checkin).isValid()) {
		if (moment(sp.checkin).isBefore(mind) || moment(sp.checkin).isAfter(maxd)) {
			sp.checkin = mind; // make sure checkin is between the min and max booking dates
		}
		sp.checkin = moment(sp.checkin).format(df);
	}
	else {
		sp.checkin = null;
	}
	
	// fixup the checkout (data)
	if (sp.checkout!==null && sp.checkout!='' && moment(sp.checkout).isValid()) {
		if (moment(sp.checkout).isBefore(sp.checkin) || moment(sp.checkout).isAfter(maxd)) {
			sp.checkout = moment(sp.checkin).add('days', context.config().minlos);
		}
		sp.checkout = moment(sp.checkout).format(df);
	}
	else {
		sp.checkout = null;
	}
	
	// fixup the checkin (display)
	if (sp.checkin!==null && sp.checkin!='' && moment(sp.checkin).isValid()) {
		sp.scheckin = moment(sp.checkin).format(dfparse);
	}
	else {
		sp.scheckin = null;
	}	
	
	// fixup the checkout (display)
	if (sp.checkout!==null && sp.checkout!='' && moment(sp.checkout).isValid()) {
		sp.scheckout = moment(sp.checkout).format(dfparse);
	}
	else {
		sp.scheckout = null;
	}	
}

})(BAPI); 
